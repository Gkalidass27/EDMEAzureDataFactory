{
	"name": "locations_dataflow_copy1",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "store_payload_input_ds_copy1",
						"type": "DatasetReference"
					},
					"name": "sourceLocation"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSqlBusinessCategories",
						"type": "DatasetReference"
					},
					"name": "sinkBusinessCategories"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlBusinessDetails",
						"type": "DatasetReference"
					},
					"name": "sinkBusinessDetails"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlPhotoUrls",
						"type": "DatasetReference"
					},
					"name": "sinkLocationPhotUrls"
				}
			],
			"transformations": [
				{
					"name": "selectData"
				},
				{
					"name": "flattenPhotoUrls"
				}
			],
			"script": "source(output(\n\t\tbody as (AccountID as string, Created as string, CreatedBy as string, LocationData as (AlternateWebsiteURL as string, AreasServed as string, Brands as string, BusinessCategories as (Category1 as string, Category2 as string, Category3 as string, Category4 as string, Category5 as string, Category6 as string, Category7 as string, Category8 as string, Category9 as string), BusinessDescription as (Description as string, LongDescription as string, ShortDescription as string), BusinessName as (Locale as short, LongName as string, Name as string), BusinessStatus as string, CredentialsCertifications as string, DisplayPoint as (Latitude as double, Longitude as double, Type as string, VerificationType as string), HoursOfOperationStructured as (Fr as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Mo as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Sa as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Su as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Th as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Tu as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), We as (Ranges as (EndTime as string, StartTime as string)[], State as boolean)), KeyFields as (AgencyCode as short, AutoDisplayPoint as string, CMR as short, CSOLocationID as integer, ChainName as string, CustomerServiceHours as string, Exteriorphoto as string, Flyerlink as string, GoogleBusinessDescription as string, HideAddress as boolean, ITGAccountId as integer, ITGAccountNumber as short, ITGClientId as short, ITGClientNumber as short, ManagerDescription as string, ManagerName as string, {Open Holidays} as boolean, PinMarker as boolean, Promotion1Image as string, {Reference Code} as integer, ScheduleApptURL as string, primarylanguage as string), KeywordsSpecialties as string, MediaURLs as (FacebookURL as string, InstagramURL as string, LinkedInURL as string, PinterestURL as string, TwitterURL as string), PaymentMethods as string, PhoneNumbers as (Fax as long, Landline as long, PrimaryPhoneNumber as long), PhotoURLs as (Description as string, Name as string, Type as string, URL as string)[], PrimaryAddress as (AddressLine1 as string, CountryCode as string, Locality as string, PostalCode as short, Region as string), Products as string, Services as string, Status as string, Tagline as string, WebsiteURL as string, YearFounded as date), LocationID as string, LocationNumber as long, Modified as string, ModifiedBy as string, ReferenceCode as integer),\n\t\theaders as [string,string]\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\thttpMethod: 'GET',\n\ttimeout: 30,\n\trequestInterval: 0,\n\tpaginationRules: ['supportRFC5988' -> 'true'],\n\tresponseFormat: ['type' -> 'json', 'documentForm' -> 'singleDocument']) ~> sourceLocation\nsourceLocation select(mapColumn(\n\t\tbody,\n\t\theaders\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> selectData\nselectData foldDown(unroll(body.LocationData.PhotoURLs, body.LocationData.PhotoURLs),\n\tmapColumn(\n\t\tDescription = body.LocationData.PhotoURLs.Description,\n\t\tName = body.LocationData.PhotoURLs.Name,\n\t\tType = body.LocationData.PhotoURLs.Type,\n\t\tURL = body.LocationData.PhotoURLs.URL,\n\t\tLocationNumber = body.LocationNumber\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> flattenPhotoUrls\nselectData sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tCategory1 as string,\n\t\tCategory2 as string,\n\t\tCategory3 as string,\n\t\tCategory4 as string,\n\t\tCategory5 as string,\n\t\tCategory6 as string,\n\t\tCategory7 as string,\n\t\tCategory8 as string,\n\t\tCategory9 as string,\n\t\tCategory10 as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tLocationNumber = body.LocationNumber,\n\t\tCategory1 = body.LocationData.BusinessCategories.Category1,\n\t\tCategory2 = body.LocationData.BusinessCategories.Category2,\n\t\tCategory3 = body.LocationData.BusinessCategories.Category3,\n\t\tCategory4 = body.LocationData.BusinessCategories.Category4,\n\t\tCategory5 = body.LocationData.BusinessCategories.Category5,\n\t\tCategory6 = body.LocationData.BusinessCategories.Category6,\n\t\tCategory7 = body.LocationData.BusinessCategories.Category7,\n\t\tCategory8 = body.LocationData.BusinessCategories.Category8,\n\t\tCategory9 = body.LocationData.BusinessCategories.Category9\n\t)) ~> sinkBusinessCategories\nselectData sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tBusinessStatus as string,\n\t\tBusinessName as string,\n\t\tBusinessLongName as string,\n\t\tLocale as string,\n\t\tBusinessDescription as string,\n\t\tBusinessShortDescription as string,\n\t\tBusinessLongDescription as string,\n\t\tWebsiteURL as string,\n\t\tAlternateWebsiteURL as string,\n\t\tMediaURL as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tLocationNumber = body.LocationNumber,\n\t\tBusinessStatus = body.LocationData.BusinessStatus,\n\t\tBusinessName = body.LocationData.BusinessName.Name,\n\t\tBusinessLongName = body.LocationData.BusinessName.LongName,\n\t\tLocale = body.LocationData.BusinessName.Locale,\n\t\tBusinessDescription = body.LocationData.BusinessDescription.Description,\n\t\tBusinessShortDescription = body.LocationData.BusinessDescription.ShortDescription,\n\t\tBusinessLongDescription = body.LocationData.BusinessDescription.LongDescription,\n\t\tWebsiteURL = body.LocationData.WebsiteURL,\n\t\tAlternateWebsiteURL = body.LocationData.AlternateWebsiteURL\n\t)) ~> sinkBusinessDetails\nflattenPhotoUrls sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tCategory1 as string,\n\t\tCategory2 as string,\n\t\tCategory3 as string,\n\t\tCategory4 as string,\n\t\tCategory5 as string,\n\t\tCategory6 as string,\n\t\tCategory7 as string,\n\t\tCategory8 as string,\n\t\tCategory9 as string,\n\t\tCategory10 as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\ttruncate:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> sinkLocationPhotUrls"
		}
	}
}