{
	"name": "df_store_details",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_store_details_source",
						"type": "DatasetReference"
					},
					"name": "sourceStoreDetails"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSqlBusinessCategories",
						"type": "DatasetReference"
					},
					"name": "sinkBusinessCategories"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlBusinessDetails",
						"type": "DatasetReference"
					},
					"name": "sinkBusinessDetails"
				}
			],
			"transformations": [
				{
					"name": "selectBusinesCategories"
				},
				{
					"name": "flatten1"
				}
			],
			"script": "source(output(\n\t\tAccountID as string,\n\t\tCreated as string,\n\t\tCreatedBy as string,\n\t\tLocationData as (AlternateWebsiteURL as string, AreasServed as string, Brands as string, BusinessCategories as (Category1 as string, Category2 as string, Category3 as string, Category4 as string, Category5 as string, Category6 as string, Category7 as string, Category8 as string, Category9 as string), BusinessDescription as (Description as string, LongDescription as string, ShortDescription as string), BusinessName as (Locale as short, LongName as string, Name as string), BusinessStatus as string, DisplayPoint as (Latitude as double, Longitude as double, Type as string, VerificationType as string), EmailAddress as string, HoursOfOperationStructured as (Fr as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Mo as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Sa as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Su as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Th as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), Tu as (Ranges as (EndTime as string, StartTime as string)[], State as boolean), We as (Ranges as (EndTime as string, StartTime as string)[], State as boolean)), KeyFields as (AgencyCode as short, AutoDisplayPoint as string, CMR as short, CSOLocationID as integer, ChainName as string, CustomerServiceHours as string, {Date Terminated} as timestamp, Exteriorphoto as string, Flyerlink as string, {Google Preferred Photo} as string, GoogleBusinessDescription as string, HideAddress as boolean, ITGAccountId as integer, ITGAccountNumber as short, ITGClientId as short, ITGClientNumber as short, {Open Holidays} as boolean, PinMarker as boolean, Promotion1Image as string, Promotion2Image as string, {Reference Code} as integer, primarylanguage as string), KeywordsSpecialties as string, MediaURLs as (FacebookURL as string, TwitterURL as string), PaymentMethods as string, PhoneNumbers as (Fax as long, Landline as long, PrimaryPhoneNumber as long), PhotoURLs as (Description as string, Name as string, Type as string, URL as string)[], PrimaryAddress as (AddressLine1 as string, CountryCode as string, Locality as string, PostalCode as integer, Region as string), Products as string, Services as string, Status as string, Tagline as string, WebsiteURL as string),\n\t\tLocationID as string,\n\t\tLocationNumber as long,\n\t\tModified as string,\n\t\tModifiedBy as string,\n\t\tReferenceCode as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tdocumentForm: 'documentPerLine') ~> sourceStoreDetails\nsourceStoreDetails select(mapColumn(\n\t\tAccountID,\n\t\tCreated,\n\t\tCreatedBy,\n\t\tLocationData,\n\t\tLocationID,\n\t\tLocationNumber,\n\t\tModified,\n\t\tModifiedBy,\n\t\tReferenceCode\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> selectBusinesCategories\nsourceStoreDetails foldDown(unroll(LocationData.PhotoURLs),\n\tmapColumn(\n\t\tAlternateWebsiteURL = LocationData.AlternateWebsiteURL,\n\t\tBusinessCategories = LocationData.BusinessCategories,\n\t\tBusinessDescription = LocationData.BusinessDescription,\n\t\tBusinessName = LocationData.BusinessName,\n\t\tBusinessStatus = LocationData.BusinessStatus,\n\t\tBusinessLongName = LocationData.BusinessName.LongName,\n\t\tLocale = LocationData.BusinessName.Locale,\n\t\tBusinessShortDescription = LocationData.BusinessDescription.ShortDescription,\n\t\tBusinessLongDescription = LocationData.BusinessDescription.LongDescription,\n\t\tMediaURL = LocationData.MediaURLs,\n\t\tLocationNumber,\n\t\tWebsiteURL = LocationData.WebsiteURL,\n\t\tStatus = LocationData.Status\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> flatten1\nselectBusinesCategories sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tCategory1 as string,\n\t\tCategory2 as string,\n\t\tCategory3 as string,\n\t\tCategory4 as string,\n\t\tCategory5 as string,\n\t\tCategory6 as string,\n\t\tCategory7 as string,\n\t\tCategory8 as string,\n\t\tCategory9 as string,\n\t\tCategory10 as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tLocationNumber,\n\t\tCategory1 = LocationData.BusinessCategories.Category1,\n\t\tCategory2 = LocationData.BusinessCategories.Category2,\n\t\tCategory3 = LocationData.BusinessCategories.Category3,\n\t\tCategory4 = LocationData.BusinessCategories.Category4,\n\t\tCategory5 = LocationData.BusinessCategories.Category5,\n\t\tCategory6 = LocationData.BusinessCategories.Category6,\n\t\tCategory7 = LocationData.BusinessCategories.Category7,\n\t\tCategory8 = LocationData.BusinessCategories.Category8,\n\t\tCategory9 = LocationData.BusinessCategories.Category9\n\t)) ~> sinkBusinessCategories\nflatten1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tBusinessStatus as string,\n\t\tBusinessName as string,\n\t\tBusinessLongName as string,\n\t\tLocale as string,\n\t\tBusinessDescription as string,\n\t\tBusinessShortDescription as string,\n\t\tBusinessLongDescription as string,\n\t\tWebsiteURL as string,\n\t\tAlternateWebsiteURL as string,\n\t\tMediaURL as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tLocationNumber,\n\t\tBusinessStatus,\n\t\tBusinessName = BusinessName.Name,\n\t\tBusinessLongName,\n\t\tLocale = BusinessName.Locale,\n\t\tBusinessDescription = BusinessDescription.Description,\n\t\tBusinessShortDescription,\n\t\tBusinessLongDescription,\n\t\tWebsiteURL,\n\t\tAlternateWebsiteURL\n\t)) ~> sinkBusinessDetails"
		}
	}
}