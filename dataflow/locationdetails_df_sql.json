{
	"name": "locationdetails_df_sql",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Json_dac_source_ds",
						"type": "DatasetReference"
					},
					"name": "sourceDACJson"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSqlLocationServices",
						"type": "DatasetReference"
					},
					"name": "sinkLocationServices"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlBusinessDetails",
						"type": "DatasetReference"
					},
					"name": "sinkBusinessDetails"
				}
			],
			"transformations": [
				{
					"name": "flattenLocationServices"
				},
				{
					"name": "flattenBusinessDetails"
				}
			],
			"script": "source(output(\n\t\tAccountID as string,\n\t\tLocationID as string,\n\t\tLocationNumber as string,\n\t\tReferenceCode as string,\n\t\tCreatedBy as string,\n\t\tModifiedBy as string,\n\t\tCreated as string,\n\t\tModified as string,\n\t\tLocationData as (KeyFields as (CSOLocationID as string, ITGAccountId as string, ITGAccountNumber as string, ITGClientId as string, ITGClientNumber as string, AgencyCode as string, {Reference Code} as string, CMR as string, {Open Holidays} as string, Exteriorphoto as string, AutoDisplayPoint as string, HideAddress as string, PinMarker as string, ChainName as string, primarylanguage as string, Promotion1Image as string, Promotion1URL as string, GoogleBusinessDescription as string, CustomerServiceHours as string, Flyerlink as string, ManagerDescription as string, ScheduleApptURL as string, ManagerName as string, {Reference Code 2} as string, Promotion2Image as string), DisplayPoint as (Type as string, Latitude as double, Longitude as double, VerificationType as string), BusinessStatus as string, Status as string, BusinessName as (Name as string, LongName as string, Locale as integer), BusinessDescription as (Description as string, ShortDescription as string, LongDescription as string), PrimaryAddress as (AddressLine1 as string, Locality as string, Region as string, PostalCode as string, CountryCode as string), PhoneNumbers as (PrimaryPhoneNumber as string, Fax as string, Landline as string), WebsiteURL as string, AlternateWebsiteURL as string, MediaURLs as (FacebookURL as string, TwitterURL as string, LinkedInURL as string, InstagramURL as string, PinterestURL as string), HoursOfOperationStructured as (Su as (Ranges as (StartTime as string, EndTime as string)[], State as integer), Mo as (Ranges as (StartTime as string, EndTime as string)[], State as integer), Tu as (Ranges as (StartTime as string, EndTime as string)[], State as integer), We as (Ranges as (StartTime as string, EndTime as string)[], State as integer), Th as (Ranges as (StartTime as string, EndTime as string)[], State as integer), Fr as (Ranges as (StartTime as string, EndTime as string)[], State as integer), Sa as (Ranges as (StartTime as string, EndTime as string)[], State as integer)), BusinessCategories as (Category1 as string, Category2 as string, Category3 as string, Category4 as string, Category5 as string, Category6 as string, Category7 as string, Category8 as string, Category9 as string), PhotoURLs as (Type as string, URL as string, Name as string)[], KeywordsSpecialties as string, Products as string, Services as string, Brands as string, Tagline as string, AreasServed as string, PaymentMethods as string, CredentialsCertifications as string, YearFounded as string)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tdocumentForm: 'documentPerLine') ~> sourceDACJson\nsourceDACJson foldDown(unroll(LocationData.PhotoURLs),\n\tmapColumn(\n\t\tKeywordsSpecialties = LocationData.KeywordsSpecialties,\n\t\tProducts = LocationData.Products,\n\t\tServices = LocationData.Services,\n\t\tBrands = LocationData.Brands,\n\t\tTagline = LocationData.Tagline,\n\t\tAreasServed = LocationData.AreasServed,\n\t\tLocationNumber\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> flattenLocationServices\nsourceDACJson foldDown(unroll(LocationData.PhotoURLs),\n\tmapColumn(\n\t\tBusinessStatus = LocationData.BusinessStatus,\n\t\tBusinessName = LocationData.BusinessName,\n\t\tBusinessDescription = LocationData.BusinessDescription,\n\t\tLocationNumber,\n\t\tBusinessLongName = LocationData.BusinessName.LongName,\n\t\tLocale = LocationData.BusinessName.Locale,\n\t\tBusinessShortDescription = LocationData.BusinessDescription.ShortDescription,\n\t\tLongDescription = LocationData.BusinessDescription.LongDescription,\n\t\tWebsiteURL = LocationData.WebsiteURL,\n\t\tAlternateWebsiteURL = LocationData.AlternateWebsiteURL\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> flattenBusinessDetails\nflattenLocationServices sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tKeywordsSpecialties as string,\n\t\tProducts as string,\n\t\tServices as string,\n\t\tBrands as string,\n\t\tTagline as string,\n\t\tAreasServed as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> sinkLocationServices\nflattenBusinessDetails sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tLocationNumber as string,\n\t\tBusinessStatus as string,\n\t\tBusinessName as string,\n\t\tBusinessLongName as string,\n\t\tLocale as string,\n\t\tBusinessDescription as string,\n\t\tBusinessShortDescription as string,\n\t\tBusinessLongDescription as string,\n\t\tWebsiteURL as string,\n\t\tAlternateWebsiteURL as string,\n\t\tMediaURL as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tBusinessStatus,\n\t\tBusinessName,\n\t\tBusinessDescription,\n\t\tLocationNumber,\n\t\tBusinessLongName,\n\t\tLocale,\n\t\tBusinessShortDescription,\n\t\tBusinessLongDescription = LongDescription,\n\t\tWebsiteURL,\n\t\tAlternateWebsiteURL\n\t)) ~> sinkBusinessDetails"
		}
	}
}